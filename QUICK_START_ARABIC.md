# دليل التشغيل السريع لمشروع مشاعر المحسن

هذا الدليل يشرح كيفية تشغيل مشروع مشاعر المحسن بسرعة وسهولة.

## متطلبات النظام

- نظام تشغيل Windows
- Python 3.x
- Node.js و npm

## خطوات التشغيل السريع

### الطريقة الموصى بها: استخدام ملف التشغيل المعزز (Enhanced Starter)

1. انقر نقرًا مزدوجًا على ملف `enhanced-start.bat` الموجود في المجلد الرئيسي للمشروع.
2. سيقوم البرنامج تلقائيًا بتنفيذ الخطوات التالية:
   - إصلاح مشاكل تثبيت tokenizers
   - تشخيص النظام وإصلاح المشاكل الشائعة
   - إعداد بيئة التطوير المناسبة
   - تمكين وظائف الصوت (صوت آريا)
   - تشغيل خادم Flask الخلفي
   - تشغيل واجهة المستخدم الأمامية React

### الطريقة البديلة: استخدام ملف التشغيل العادي

1. انقر نقرًا مزدوجًا على ملف `quick-start.bat` الموجود في المجلد الرئيسي للمشروع.
2. سيقوم البرنامج تلقائيًا بتنفيذ الخطوات التالية:
   - تثبيت cross-env إذا لم يكن موجودًا
   - إعداد متغير البيئة NODE_OPTIONS
   - تشغيل خادم Flask الخلفي
   - تشغيل واجهة المستخدم الأمامية React

### الطريقة 2: التشغيل اليدوي

إذا كنت تفضل تنفيذ الخطوات يدويًا، يمكنك اتباع الخطوات التالية:

1. تثبيت cross-env:
   ```
   npm install --save-dev cross-env
   ```

2. إعداد متغير البيئة NODE_OPTIONS (في PowerShell):
   ```
   $env:NODE_OPTIONS="--openssl-legacy-provider"
   ```

3. تشغيل الواجهة الأمامية:
   ```
   npm start
   ```

4. تشغيل خادم Flask الخلفي (في نافذة PowerShell منفصلة):
   ```
   .\venv\Scripts\activate
   python backend/app.py
   ```

## استكشاف الأخطاء وإصلاحها

إذا واجهت أي مشاكل أثناء تشغيل المشروع، يرجى التحقق مما يلي:

1. تأكد من تثبيت Python و Node.js بشكل صحيح.
2. تأكد من أن البيئة الافتراضية (venv) تم إنشاؤها وتنشيطها بشكل صحيح.
3. تحقق من تثبيت جميع التبعيات المطلوبة.

### مشاكل شائعة عند استخدام ملف التشغيل المعزز

إذا واجهت مشكلات عند استخدام ملف `enhanced-start.bat`:

1. **الواجهة الخلفية لا تعمل**: تحقق من ملفات السجل في دليل المشروع للبحث عن رسائل الخطأ
2. **الصوت لا يعمل**: تأكد من أن متصفحك يسمح بالوصول إلى الميكروفون وتشغيل الصوت
3. **واجهة المستخدم لا تحمل**: تحقق من وحدة التحكم في المتصفح بحثًا عن رسائل الخطأ
4. **لا تزال هناك مشكلات في tokenizers**: حاول تشغيل `fix-tokenizers-install.bat` يدويًا قبل البدء

### خطأ "Can't resolve 'process/browser'"

إذا واجهت خطأ "Can't resolve 'process/browser' in axios/lib/utils.js"، فهذا بسبب أن Webpack 5 لم يعد يحتوي على polyfills تلقائية لبعض مكتبات Node مثل process و buffer و stream.

تم حل هذه المشكلة في ملف `config-overrides.js` عن طريق:
1. إضافة `resolve.fallback` لـ Webpack 5
2. الاحتفاظ بـ `resolve.alias` للتوافق مع الإصدارات السابقة
3. إضافة `webpack.DefinePlugin` لتعريف `process.env` بشكل صريح لـ axios

### خطأ سياسة أمن المحتوى (CSP)

إذا واجهت خطأ يتعلق بسياسة أمن المحتوى (Content Security Policy) يمنع استخدام دوال مثل `eval()` أو `new Function()`، فهذا بسبب أن إعدادات Webpack تستخدم "eval" في خيار devtool.

تم حل هذه المشكلة في ملف `config-overrides.js` عن طريق:
1. تغيير إعداد `devtool` من "eval" إلى "source-map"
2. هذا يمنع استخدام دالة `eval()` في الكود المُنتَج، مما يجعل التطبيق متوافقًا مع سياسات أمن المحتوى الصارمة في المتصفحات الحديثة

### مشكلة "التطبيق لا يعمل" أو فشل تثبيت تبعيات الواجهة الأمامية

إذا كان التطبيق لا يعمل أو واجهت مشاكل في تثبيت تبعيات الواجهة الأمامية (npm install)، يمكنك استخدام ملف الإصلاح الخاص بنا:

```
.\fix-npm-install.bat
```

هذا الملف سيقوم بما يلي:
1. إزالة مجلد node_modules وملف package-lock.json للبدء من جديد
2. تمكين حل تعارضات التبعيات بشكل صحيح
3. تثبيت التبعيات الأساسية بإصدارات متوافقة
4. تكوين polyfills الخاصة بـ webpack بشكل صحيح
5. إعادة تثبيت جميع التبعيات مع إعداد legacy OpenSSL provider

بعد تشغيل هذا الملف، يجب أن تكون قادرًا على تشغيل التطبيق بشكل طبيعي باستخدام `.\start-mashaaer.ps1`

إذا استمرت المشاكل، يمكنك تشغيل البرنامج التشخيصي:
```
powershell -ExecutionPolicy Bypass -File diagnose.ps1
```

## ملاحظات إضافية

- يجب أن يكون خادم Flask الخلفي قيد التشغيل لكي تعمل الواجهة الأمامية بشكل صحيح.
- يمكنك إيقاف التطبيق بالضغط على Ctrl+C في نوافذ الطرفية.

## مميزات ملف التشغيل المعزز (Enhanced Starter)

ملف التشغيل المعزز `enhanced-start.bat` يوفر المميزات التالية:

1. **إصلاح مشاكل tokenizers**: يعالج تلقائيًا مشاكل تثبيت حزمة tokenizers، خاصة على Python 3.13+
2. **تحسين عملية بدء التشغيل**: يحسن عملية بدء تشغيل النظام مع معالجة أفضل للأخطاء وإعادة المحاولات
3. **تفعيل وظائف الصوت**: يضمن عمل صوت آريا دون الحاجة إلى متطلبات المصادقة
4. **تحسين الاتصال بالواجهة الخلفية**: ينفذ منطق إعادة المحاولة وآليات الرجوع الأفضل

لمزيد من المعلومات التفصيلية حول ميزات وقدرات مشاعر، راجع ملف [README.md](README.md) الرئيسي أو [ENHANCED_START_GUIDE.md](ENHANCED_START_GUIDE.md) للحصول على تفاصيل كاملة حول ملف التشغيل المعزز.
