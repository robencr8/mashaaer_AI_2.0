"""
Sleep Coach Engine - Provides guidance for improving sleep quality.
"""

def handle_sleep_query(prompt: str) -> str:
    """
    Handles queries related to sleep improvement and sleep disorders.
    
    Args:
        prompt (str): The user's prompt/query related to sleep
        
    Returns:
        str: Response with sleep improvement advice
    """
    # Simple keyword-based response system
    # In a real implementation, this would connect to a more sophisticated sleep coaching system
    
    if "أرق" in prompt or "صعوبة النوم" in prompt:
        return "للتغلب على الأرق وصعوبة النوم:\n\n1. التزم بجدول نوم ثابت: اذهب للنوم واستيقظ في نفس الوقت يومياً، حتى في عطلة نهاية الأسبوع.\n\n2. جهز بيئة نوم مثالية: غرفة مظلمة، هادئة، وباردة نسبياً (18-20 درجة مئوية).\n\n3. تجنب الشاشات قبل النوم: أبعد الهواتف والأجهزة الإلكترونية قبل النوم بساعة على الأقل.\n\n4. مارس روتيناً مسائياً مهدئاً: قراءة كتاب، استماع لموسيقى هادئة، أو تمارين استرخاء.\n\n5. تجنب المنبهات: لا تتناول الكافيين بعد الظهر، وتجنب الوجبات الثقيلة والكحول قبل النوم.\n\n6. مارس تمارين التنفس العميق: 4-7-8 (شهيق لـ4 ثوانٍ، حبس لـ7، زفير لـ8).\n\nإذا استمر الأرق لأكثر من شهر، استشر طبيباً مختصاً."

    elif "استيقاظ" in prompt or "صحو" in prompt:
        return "لتحسين الاستيقاظ والشعور بالنشاط صباحاً:\n\n1. اجعل الاستيقاظ تدريجياً: استخدم منبهاً بضوء يتزايد تدريجياً أو تطبيقات تراقب دورات النوم.\n\n2. تعرض للضوء الطبيعي فوراً: افتح الستائر أو اخرج للشرفة لتنبيه جسمك.\n\n3. تجنب تأجيل المنبه: ضع المنبه بعيداً عن السرير لتضطر للنهوض لإيقافه.\n\n4. ابدأ بروتين صباحي منشط: تمارين خفيفة، تمدد، أو تأمل لمدة 5-10 دقائق.\n\n5. رطب جسمك: اشرب كوباً من الماء فور الاستيقاظ لتعويض الجفاف الليلي.\n\n6. تناول فطوراً متوازناً: يحتوي على بروتين وألياف لتزويد جسمك بالطاقة.\n\nالاستيقاظ المنتظم في نفس الوقت يومياً يضبط الساعة البيولوجية ويحسن جودة النوم ليلاً."

    elif "نوم عميق" in prompt or "جودة النوم" in prompt:
        return "لتحسين جودة النوم والوصول للنوم العميق:\n\n1. مارس النشاط البدني بانتظام: 30 دقيقة يومياً على الأقل، لكن ليس قبل النوم مباشرة.\n\n2. تعرض للضوء الطبيعي نهاراً: يساعد في ضبط إيقاع الساعة البيولوجية.\n\n3. قلل من القيلولة النهارية: إذا كنت بحاجة للقيلولة، اجعلها قصيرة (20-30 دقيقة) وقبل الساعة 3 عصراً.\n\n4. جرب تقنيات الاسترخاء: الاسترخاء العضلي التدريجي، التأمل، أو اليوغا المسائية.\n\n5. استخدم السرير للنوم فقط: تجنب العمل أو مشاهدة التلفاز في السرير.\n\n6. تناول أطعمة تساعد على النوم: الكرز الحامض، الموز، الشوفان، واللوز تحتوي على مواد تعزز النوم.\n\nالنوم العميق ضروري لتجديد الخلايا وتقوية جهاز المناعة والذاكرة."

    elif "أحلام" in prompt or "كوابيس" in prompt:
        return "للتعامل مع الأحلام المزعجة والكوابيس:\n\n1. حافظ على روتين نوم منتظم: الاضطراب في مواعيد النوم يزيد من احتمالية الكوابيس.\n\n2. تجنب مسببات الإجهاد قبل النوم: أخبار مزعجة، أفلام رعب، أو مناقشات محتدمة.\n\n3. مارس تقنيات الاسترخاء: التنفس العميق أو التأمل قبل النوم.\n\n4. اكتب يومية أحلام: تدوين الأحلام يساعد في فهمها والتعامل معها.\n\n5. أعد برمجة الحلم: فكر في نهاية إيجابية للكابوس المتكرر قبل النوم.\n\n6. تحدث عن مخاوفك: مشاركة القلق مع شخص موثوق أو معالج نفسي.\n\nإذا كانت الكوابيس متكررة ومؤثرة على حياتك، استشر مختصاً نفسياً فقد تكون مرتبطة بالقلق أو اضطراب ما بعد الصدمة."

    elif "شخير" in prompt or "انقطاع النفس" in prompt:
        return "للتعامل مع الشخير وانقطاع النفس أثناء النوم:\n\n1. نم على جانبك: النوم على الظهر يزيد من احتمالية الشخير.\n\n2. حافظ على وزن صحي: زيادة الوزن تضغط على مجرى التنفس.\n\n3. تجنب الكحول والمهدئات: ترخي عضلات الحلق وتزيد الشخير.\n\n4. رطب مجرى التنفس: استخدم مرطب هواء في غرفة النوم.\n\n5. عالج الحساسية: الاحتقان الأنفي يزيد من صعوبة التنفس ليلاً.\n\n6. ارفع رأسك قليلاً: استخدم وسادة إضافية أو ارفع رأس السرير 10-15 سم.\n\nإذا كان الشخير شديداً أو مصحوباً بتوقف مؤقت للتنفس، استشر طبيباً فوراً فقد يكون مؤشراً على انقطاع النفس النومي الذي يحتاج لعلاج طبي."

    elif "قلق" in prompt or "توتر" in prompt:
        return "للتغلب على القلق والتوتر المؤثر على النوم:\n\n1. خصص وقتاً للقلق: حدد 15-20 دقيقة في وقت مبكر من المساء لكتابة مخاوفك وحلولها المحتملة.\n\n2. مارس تمارين الاسترخاء قبل النوم: التنفس العميق، الاسترخاء العضلي التدريجي، أو التأمل.\n\n3. جرب تقنية المسح الجسدي: انتبه لكل جزء من جسمك بالتتابع وحاول إرخاءه.\n\n4. استمع لموسيقى هادئة أو تطبيقات الاسترخاء: الأصوات الطبيعية كالمطر أو الأمواج.\n\n5. تجنب التفكير في المشكلات قبل النوم: أجّل التفكير في القضايا المقلقة للصباح.\n\n6. مارس اليقظة الذهنية: ركز على اللحظة الحالية بدلاً من القلق بشأن الماضي أو المستقبل.\n\nإذا كان القلق مستمراً ومؤثراً على نومك، فكر في استشارة معالج نفسي."

    elif "أطفال" in prompt or "طفل" in prompt:
        return "لتحسين نوم الأطفال:\n\n1. حافظ على روتين نوم ثابت: قصة، أغنية هادئة، أو حمام دافئ قبل النوم.\n\n2. اضبط بيئة النوم: غرفة هادئة، مظلمة، وبدرجة حرارة مناسبة.\n\n3. حدد وقتاً للنشاط البدني: تأكد من حصول طفلك على نشاط كافٍ خلال النهار، لكن ليس قبل النوم مباشرة.\n\n4. قلل من وقت الشاشات: أبعد الأجهزة الإلكترونية قبل النوم بساعة على الأقل.\n\n5. انتبه للتغذية: تجنب السكريات والكافيين قبل النوم، وتأكد من عدم نوم الطفل جائعاً.\n\n6. علم طفلك مهارات تهدئة الذات: ساعده على تطوير طرق للاسترخاء بنفسه عند الاستيقاظ ليلاً.\n\nتذكر أن احتياجات النوم تختلف حسب عمر الطفل، فالأطفال الصغار يحتاجون لساعات نوم أكثر من الأطفال الأكبر سناً."

    elif "دواء" in prompt or "علاج" in prompt:
        return "معلومات عن علاجات وأدوية النوم:\n\n1. العلاجات الطبيعية: الميلاتونين، الفاليريان، الكاموميل، والماغنيسيوم قد تساعد على تحسين النوم.\n\n2. أدوية النوم بدون وصفة: متوفرة في الصيدليات لكن يجب استخدامها لفترات قصيرة وباستشارة الصيدلي.\n\n3. أدوية النوم بوصفة طبية: تُستخدم في حالات الأرق الشديد، وتحتاج لإشراف طبي دقيق.\n\n4. العلاج السلوكي المعرفي للأرق (CBT-I): يعالج الأفكار والسلوكيات المسببة للأرق، ويعتبر العلاج الأول الموصى به للأرق المزمن.\n\n5. العلاج بالضوء: يساعد في اضطرابات إيقاع الساعة البيولوجية.\n\nتحذير: لا تستخدم أي دواء للنوم دون استشارة طبية. الاعتماد على أدوية النوم قد يسبب الإدمان ويؤثر سلباً على جودة النوم على المدى الطويل."

    elif "ساعة بيولوجية" in prompt or "إيقاع يومي" in prompt:
        return "لضبط الساعة البيولوجية وتحسين الإيقاع اليومي:\n\n1. التزم بمواعيد نوم واستيقاظ ثابتة: حتى في العطلات والإجازات.\n\n2. تعرض للضوء الطبيعي صباحاً: 15-30 دقيقة من ضوء الشمس المباشر بعد الاستيقاظ.\n\n3. تناول الوجبات في أوقات منتظمة: يساعد في ضبط الساعة البيولوجية.\n\n4. مارس الرياضة في نفس الوقت يومياً: يفضل في الصباح أو بعد الظهر المبكر.\n\n5. قلل الضوء الأزرق مساءً: استخدم خاصية تصفية الضوء الأزرق على الأجهزة الإلكترونية.\n\n6. تعامل مع اختلال الإيقاع اليومي تدريجياً: عند السفر أو تغيير نظام العمل، عدّل وقت النوم بمعدل 15-30 دقيقة يومياً.\n\nالساعة البيولوجية تنظم ليس فقط النوم، بل أيضاً الهرمونات، درجة الحرارة، والشهية."

    elif "قيلولة" in prompt or "نوم النهار" in prompt:
        return "لاستفادة مثلى من القيلولة النهارية:\n\n1. حدد وقتاً مناسباً: أفضل وقت للقيلولة هو بعد الظهر (بين 1-3 ظهراً).\n\n2. اضبط المدة: القيلولة المثالية تتراوح بين 10-30 دقيقة، تجنب النوم لأكثر من 30 دقيقة لتفادي الشعور بالخمول.\n\n3. هيئ بيئة مناسبة: مكان هادئ ومظلم نسبياً.\n\n4. استخدم منبهاً: لتجنب النوم لفترة طويلة تؤثر على نوم الليل.\n\n5. تجنب القيلولة المتأخرة: النوم بعد الساعة 3 عصراً قد يؤثر على نوم الليل.\n\n6. قهوة النوم (Coffee Nap): شرب فنجان قهوة قبل قيلولة قصيرة (20 دقيقة) يمكن أن يعزز اليقظة بعد الاستيقاظ.\n\nالقيلولة القصيرة يمكن أن تحسن الأداء المعرفي، المزاج، واليقظة دون التأثير على نوم الليل."

    else:
        return "النوم الجيد أساسي للصحة البدنية والنفسية. يمكنني مساعدتك في تحسين جوانب مختلفة من نومك مثل: التغلب على الأرق وصعوبة النوم، تحسين الاستيقاظ الصباحي، تعزيز جودة النوم العميق، التعامل مع الأحلام المزعجة والكوابيس، تقليل الشخير وانقطاع النفس، التغلب على القلق المؤثر على النوم، تحسين نوم الأطفال، معلومات عن علاجات النوم، ضبط الساعة البيولوجية، أو الاستفادة المثلى من القيلولة. ما الجانب الذي تود تحسينه في نومك؟"